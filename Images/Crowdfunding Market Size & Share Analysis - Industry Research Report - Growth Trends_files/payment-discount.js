var base_url=window.location.href.indexOf("mordorintelligence")!=-1?"https://express.mordorintelligence.com":window.location.href.indexOf("mordorlabs")!=-1?"https://express.mordorlabs.com":"http://localhost:8080";let isPromoCodeActive,promo_id,promo_title,endDate,discount,discount_upto,discounted_price,parsedEndDate;if(report_data){fetch(`${base_url}/api/promo_code?rep_id=${report_data.id}`,{headers:{"Cache-Control":"no-cache"},keepalive:true}).then(res=>{if(res.status==200){return res.json();}else{checkBannerForRd(isPromoCodeActive=false);$('.buy-now-button, .old_rd_mobile_buynow_discount').click(function(e){if(report_data.hasOwnProperty('country_code')){window.open(`${sub_domain_urls}`+`/${report_data.country_code==='zh-CN'?report_data.country_code:report_data.country_code.toLowerCase()}`+'/industry-reports/'+`${report_data.original_slug}`+'/buy-now','_self')}else{window.open(`${sub_domain_urls}`+'/industry-reports/'+`${report_data.slug}`+'/buy-now','_self')}});throw new Error("no promo code");}}).then(data=>{isPromoCodeActive=data[0].active;promo_id=(data&&data[0].id)?data[0].id:null;promo_title=(data&&data[0].id)?data[0].title:null;endDate=(data&&data[0].validity&&data[0].validity.endDate)?data[0].validity.endDate:null
discount=Math.max(data&&data[0].discount&&data[0].discount.single,data&&data[0].discount&&data[0].discount.team,data&&data[0].discount&&data[0].discount.corporate)
parsedEndDate=new Date(endDate).toDateString();checkBannerForRd(isPromoCodeActive,discount,promo_title,parsedEndDate,promo_id);console.log("ALL PROMO DATAS",discount)}).catch(error=>{$('.buy-now-button, .old_rd_mobile_buynow_discount').click(function(e){if(report_data.hasOwnProperty('country_code')){window.open(`${sub_domain_urls}`+`/${report_data.country_code==='zh-CN'?report_data.country_code:report_data.country_code.toLowerCase()}`+'/industry-reports/'+`${report_data.original_slug}`+'/buy-now','_self')}else{window.open(`${sub_domain_urls}`+'/industry-reports/'+`${report_data.slug}`+'/buy-now','_self')}});});}
function checkBannerForRd(isPromoCodeActive,discount,promo_title,parsedEndDate,promo_id){if(report_data&&isPromoCodeActive){let discount_badge=document.querySelectorAll('.payment-discount-badge');discount_badge.forEach(function(el){el.innerText=`UPTO ${discount}% OFF`;el.style.display="block";});$('.buy-now-button, .old_rd_mobile_buynow_discount').click(function(e){getDiscountedPrices(promo_id,report_data);});}
function getDiscountedPrices(promo_id,report_data){if(promo_id&&report_data){fetch(`${base_url}/api/promo_code/${promo_id}?rep_id=${report_data.id}`,{headers:{"Cache-Control":"no-cache",},keepalive:true}).then(res=>{if(res.status==200){return res.json();}else{console.log("Not 200");}}).then(data=>{console.log("bigdata",data)
let title=(data&&data.title)?data.title:null;let endvalidity=(data&&data.validity&&data.validity.endDate)?data.validity.endDate:null
discounted_price=data.discounted;promoCodeValidCheck(title,endvalidity,data)
console.log("getdiscounted prices",title,endvalidity,discounted_price)}).catch(error=>{console.log(error,'error');$('.buy-now-button, .old_rd_mobile_buynow_discount').click(function(e){if(report_data.hasOwnProperty('country_code')){window.open(`${sub_domain_urls}`+`/${report_data.country_code==='zh-CN'?report_data.country_code:report_data.country_code.toLowerCase()}`+'/industry-reports/'+`${report_data.original_slug}`+'/buy-now','_self')}else{window.open(`${sub_domain_urls}`+'/industry-reports/'+`${report_data.slug}`+'/buy-now','_self')}});});}}
function promoCodeValidCheck(title,endvalidity,data){let endvalidity2=new Date(endvalidity).toDateString();if(endvalidity2==parsedEndDate&&title==promo_title){if(report_data.hasOwnProperty('country_code')){window.open(`${sub_domain_urls}`+`/${report_data.country_code==='zh-CN'?report_data.country_code:report_data.country_code.toLowerCase()}`+'/industry-reports/'+`${report_data.original_slug}`+'/buy-now','_self')}else{window.open(`${sub_domain_urls}`+'/industry-reports/'+`${report_data.slug}`+'/buy-now','_self')}}}}